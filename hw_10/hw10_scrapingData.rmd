---
title: "HW10 Scraping data - IMDb Top 250 Rate Movies"
author: "Fariha Khan"
date: '2017-12-07'
output: 
  html_document: 
    keep_md: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
## Load packages
suppressPackageStartupMessages(library(tidyverse)) 
suppressPackageStartupMessages(library(knitr))
suppressPackageStartupMessages(library(kableExtra))
suppressPackageStartupMessages(library(stringr))
suppressPackageStartupMessages(library(rvest))
```


#### Get data from web
I wrote my code in an R script to make the markdown cleaner to view.
The rScript for the first part is found [here]()
```{r url}
suppressMessages(source('rScripts/01_scrapeData.r'))
```


#### View data structure

###### View [html_structure](https://github.com/farihakhan/STAT547-hw-khan-fariha/blob/master/hw_10/html_structure.md)

```{r strucure}
imdb

imdb %>%
      html_nodes(".titleColumn") %>% 
      html_text() %>%
      head()
```


#### Extract and structure data:

I stored each column variable into character lists. I changed some of the data types of the variables to allow analysis.

The extracted variables are:

 - Title
 
 - Year released
 
 - Rating 
 
 - Number of IMDb user votes
 
 - Brief cast info
 
 - Link associated with each movie



#### Create summary dataframe

```{r top dataset}

imdb_df <- extractFields(imdb)
imdb_df %>% glimpse()

```

#### Clean dataset

Parse out names of the cast memebers for analysis
```{r results='asis'}

imdb_df2 %>% 
      select(Title:Rating, no.Votes:Cast2) %>% 
      kable("html", align = "c", padding = 1,
            caption = "IMDb Top 250 Rated") %>% 
      kableExtra::scroll_box(height = "400px")

## Save data
## write.table(imdb_df2, "./data/imdb_top250movies_summary.tsv",
##             quote = FALSE, sep = "\t", row.names = FALSE)

```

#### Analyze datase

*Quick look at the correlation between release year and rating.*

<img src="media/yearRelease_hist.png" align = "middle">

<p>
<img src="media/yearRelease_rating.png" width="50%" height="50%" align = "left">
<img src="media/rating_noVotes.png" width="50%" height="50%" align = "right">
</p>


#### Get data from links

Creating more detailed dataset, which include:

 - Duration
 
 - Genre
 
 - Plot summary

Due to issues with memory, the top 25 movies are subsetted. This work is done in the following rScript - to avoid long lagging time when rendering the rmarkdown.

```{r, eval=FALSE, include=FALSE}
suppressMessages(source('rScripts/02_scrapeData.r'))
```

